# Neovim プラグイン解説

## 概要

プラグインをカテゴリ別に整理：

1. **ファイル操作** - oil.nvim, mini.files
2. **検索・ピッカー** - snacks.nvim
3. **ナビゲーション** - harpoon
4. **編集補助** - mini.comment, mini.surround, mini.splitjoin, mini.trailspace
5. **診断・エラー** - trouble.nvim
6. **フォーマット** - conform.nvim
7. **Markdown** - render-markdown, image-support, after/ftplugin/markdown.lua
8. **コード折りたたみ** - nvim-ufo
9. **ユーティリティ** - undotree, vim-maximizer, noice

---

## 1. ファイル操作

### oil.nvim

バッファとしてディレクトリを編集できるファイラー。

| キー | 動作 |
|------|------|
| `-` | 親ディレクトリを開く |
| `<CR>` | ファイル/ディレクトリを開く |
| `q` | 閉じる |
| `<M-h>` | 水平分割で開く |

**特徴**: ファイル操作（リネーム、削除、移動）をバッファ編集のように行える。

### mini.files

ツリー形式のファイルエクスプローラー。

| キー | 動作 |
|------|------|
| `<leader>ee` | ファイルエクスプローラーを開く |
| `<leader>ef` | 現在のファイルの場所で開く |
| `<CR>` / `L` | ディレクトリに入る / ファイルを開く |
| `-` / `H` | 親ディレクトリに戻る |

---

## 2. 検索・ピッカー (snacks.nvim)

Telescope風のファジーファインダー。

### ファイル検索

| キー | 動作 |
|------|------|
| `<leader>pf` | ファイル検索 |
| `<leader>pc` | Neovim設定ファイルを検索 |
| `<leader>ps` | grep検索 |
| `<leader>pws` | カーソル下の単語/選択範囲をgrep |

### その他

| キー | 動作 |
|------|------|
| `<leader>pk` | キーマップ検索 |
| `<leader>vh` | ヘルプページ検索 |
| `<leader>th` | カラースキーム選択 |
| `<leader>gbr` | Gitブランチ切り替え |
| `<leader>pt` | TODO コメント検索 |
| `<leader>pT` | TODO/FIX/FIXME 検索 |

### ユーティリティ

| キー | 動作 |
|------|------|
| `<leader>lg` | lazygit を開く |
| `<leader>gl` | lazygit ログ |
| `<leader>rn` | ファイル名をリネーム |
| `<leader>db` | バッファを削除 |

---

## 3. ナビゲーション (harpoon)

頻繁にアクセスするファイルをマーク・ジャンプ。

| キー | 動作 |
|------|------|
| `<leader>a` | 現在のファイルをharpoonリストに追加 |
| `<C-e>` | harpoonメニューを開く |
| `<C-y>` | マーク1番目のファイルへジャンプ |
| `<C-i>` | マーク2番目のファイルへジャンプ |
| `<C-n>` | マーク3番目のファイルへジャンプ |
| `<C-s>` | マーク4番目のファイルへジャンプ |

**使い方**: よく使うファイルを `<leader>a` で追加し、`<C-y>` 〜 `<C-s>` で瞬時にジャンプ。

---

## 4. 編集補助 (mini.nvim)

### mini.comment

コメントのトグル。

| キー | モード | 動作 |
|------|--------|------|
| `gc` | n | 行をコメントトグル |
| `gc` | v | 選択範囲をコメントトグル |
| `gcc` | n | 現在行をコメントトグル |

### mini.surround

囲み文字の追加・削除・変更。

| キー | 動作 | 例 |
|------|------|-----|
| `sa` | 囲みを追加 | `saiw"` → word を `"word"` に |
| `ds` | 囲みを削除 | `ds"` → `"word"` を `word` に |
| `sr` | 囲みを変更 | `sr"'` → `"word"` を `'word'` に |
| `sf` | 囲みを検索（右方向） | |
| `sF` | 囲みを検索（左方向） | |
| `sh` | 囲みをハイライト | |

**Tips**: `[` は空白あり、`]` は空白なしで囲む。

### mini.splitjoin

引数やリストの分割・結合。

| キー | 動作 |
|------|------|
| `sj` | 複数行を1行に結合 |
| `sk` | 1行を複数行に分割 |

**例**:
```javascript
// sk で分割
func(a, b, c)
↓
func(
  a,
  b,
  c
)

// sj で結合
func(
  a,
  b,
  c
)
↓
func(a, b, c)
```

### mini.trailspace

末尾の空白を削除。

| キー | 動作 |
|------|------|
| `<leader>cw` | 末尾の空白を削除 |

---

## 5. 診断・エラー (trouble.nvim)

診断メッセージやTODOをリスト表示。

| キー | 動作 |
|------|------|
| `<leader>xw` | ワークスペース全体の診断 |
| `<leader>xd` | 現在のバッファの診断 |
| `<leader>xq` | quickfixリスト |
| `<leader>xl` | ロケーションリスト |
| `<leader>xt` | TODOコメント一覧 |

### Trouble内の操作

| キー | 動作 |
|------|------|
| `<CR>` | 項目にジャンプ |
| `q` | 閉じる |
| `j` / `k` | 上下移動 |

---

## 6. フォーマット (conform.nvim)

| キー | 動作 |
|------|------|
| `<leader>f` | バッファをフォーマット |

### フォーマッター対応表

| 言語 | フォーマッター |
|------|---------------|
| Lua | stylua |
| JS/TS/JSX/TSX | biome-check (format + lint fix) |
| JSON | biome |
| HTML/CSS/SCSS | prettier |
| YAML/Markdown | prettier |
| Rust | LSP (rust_analyzer → rustfmt) |
| Python | LSP (ruff) |
| Go | LSP (gopls → gofumpt) |
| C/C++ | LSP (clangd) |

**動作**: conform.nvim に設定されている言語はそのフォーマッターを使用、それ以外はLSPにフォールバック。

---

## 7. Markdown

### render-markdown.nvim

Markdownをリッチに装飾表示するプラグイン。

| 機能 | 説明 |
|------|------|
| 見出し | `#` をアイコン（󰎤 󰎧 など）に置換、背景色付き |
| コードブロック | ブロック幅で背景色、言語表示 |
| チェックボックス | `[ ]` → 󰄱、`[x]` → 󰱒 に置換 |
| 箇条書き | `-` を装飾アイコンに |
| テーブル | 罫線を綺麗に描画 |

### image-support (img-clip.nvim + image.nvim)

Markdown内に画像を貼り付け・表示。

**img-clip.nvim** - クリップボードから画像を貼り付け

| キー | 動作 |
|------|------|
| `<leader>pi` | クリップボードから画像を貼り付け |

- 画像は `assets/` ディレクトリに保存
- `![alt](path)` 形式で挿入

**image.nvim** - ターミナル内で画像を表示

- Kittyグラフィックプロトコル使用（WezTerm対応）
- Markdownの画像リンクを自動検出して表示
- 依存: `pngpaste`, `imagemagick`, `luarocks magick`

### after/ftplugin/markdown.lua

Markdownファイル専用のカスタム設定。

**基本設定（自動適用）**

| 設定 | 説明 |
|------|------|
| `textwidth = 80` | 80文字で自動改行 |
| `spell = true` | スペルチェック有効 |
| `linebreak = true` | 単語の途中で改行しない |

**リスト操作キーマップ（Normal / Visual）**

| キー | 動作 |
|------|------|
| `tn` | 番号付きリスト トグル |
| `tb` | 箇条書き（`-`）トグル |
| `tc` | チェックボックス トグル |
| `tt` | タスク状態 `[ ]` ↔ `[x]` トグル |
| `tl` | スマートトグル（プレーン → 箇条書き → チェックボックス → 番号 → プレーン） |

**見出し操作**

| キー | 動作 |
|------|------|
| `<leader>h1` 〜 `h6` | 見出しレベル トグル |

**タスク一括操作**

| キー | 動作 |
|------|------|
| `<leader>tc` | 全タスクを完了にする |
| `<leader>tu` | 全タスクを未完了にする |

---

## 8. コード折りたたみ (nvim-ufo)

Treesitterベースの高速な折りたたみ。

| キー | 動作 |
|------|------|
| `za` | カーソル位置の折りたたみトグル |
| `zR` | 全ての折りたたみを開く |
| `zM` | 全ての折りたたみを閉じる |

- 起動時は全て展開（`foldlevel = 99`）
- 関数、クラス、if文などを折りたたんでコードを俯瞰可能

---

## 9. ユーティリティ

### undotree

変更履歴をツリー形式で表示・復元。

| キー | 動作 |
|------|------|
| `<leader>u` | undotreeをトグル |

### vim-maximizer

分割ウィンドウの最大化/復元。

| キー | 動作 |
|------|------|
| `<leader>sm` | 現在のウィンドウを最大化/元に戻す |

### noice.nvim

UIの改善（コマンドライン、メッセージ、通知）。

- `:` でポップアップコマンドライン
- `/` `?` で検索ポップアップ
- LSP progress 表示
- メッセージを通知スタイルで表示

---

## LSP キーマップ (lspconfig.lua)

LSPがアタッチされたバッファで使用可能。

### ナビゲーション

| キー | 動作 |
|------|------|
| `gd` | 定義へジャンプ |
| `gD` | 宣言へジャンプ |
| `gR` | 参照一覧 |
| `gi` | 実装へジャンプ |
| `gt` | 型定義へジャンプ |
| `K` | ホバードキュメント |

### 診断

| キー | 動作 |
|------|------|
| `<leader>d` | 行の診断をフロート表示 |
| `<leader>D` | バッファ全体の診断 (Telescope) |
| `<leader>lx` | 診断表示のトグル |

### リファクタリング

| キー | 動作 |
|------|------|
| `<leader>rn` | シンボルをリネーム |
| `<leader>vca` | コードアクション |

### その他

| キー | 動作 |
|------|------|
| `<leader>rs` | LSP再起動 |
| `<C-h>` (insert) | シグネチャヘルプ |

---

## 基本キーマップ (keymaps.lua)

### 移動

| キー | 動作 |
|------|------|
| `<C-d>` | 半ページ下（カーソル中央維持） |
| `<C-u>` | 半ページ上（カーソル中央維持） |
| `n` / `N` | 検索結果移動（カーソル中央維持） |

### 編集

| キー | モード | 動作 |
|------|--------|------|
| `J` / `K` | v | 選択行を上下に移動 |
| `<` / `>` | v | インデント（選択維持） |
| `<leader>p` | v | ペースト（レジスタ上書きなし） |
| `<leader>d` | n, v | 削除（レジスタに入れない） |
| `x` | n | 1文字削除（レジスタに入れない） |

### ウィンドウ・タブ

| キー | 動作 |
|------|------|
| `<leader>sv` | 縦分割 |
| `<leader>sh` | 横分割 |
| `<leader>se` | 分割を均等化 |
| `<leader>sx` | 分割を閉じる |
| `<leader>to` | 新しいタブ |
| `<leader>tx` | タブを閉じる |
| `<leader>tn` | 次のタブ |
| `<leader>tp` | 前のタブ |

### その他

| キー | 動作 |
|------|------|
| `<C-c>` | 検索ハイライトをクリア |
| `<leader>r` | カーソル下の単語を置換 |
| `<leader>x` | ファイルを実行可能にする |
| `<leader>fp` | ファイルパスをクリップボードにコピー |
| `<leader>L` | Lazy.nvim UIを開く |

---

## Leader キー

`<Space>` がリーダーキーとして設定されている。
